{
  "permissions": {
    "allow": [
      "Read(/Users/duskolicanin/git/rab_booking/**)",
      "Edit(/Users/duskolicanin/git/rab_booking/**)",
      "Write(/Users/duskolicanin/git/rab_booking/**)",
      "Bash(flutter:*)",
      "Bash(dart:*)",
      "Bash(fvm:*)",
      "Bash(git status)",
      "Bash(git diff:*)",
      "Bash(git log:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(git pull:*)",
      "Bash(git branch:*)",
      "Bash(git checkout:*)",
      "Bash(gh:*)",
      "Bash(npm:*)",
      "Bash(yarn:*)",
      "Bash(pnpm:*)",
      "Bash(make:*)",
      "Bash(gradle:*)",
      "Bash(pod:*)",
      "Bash(xcrun simctl list:*)",
      "Bash(xcrun simctl:*)",
      "Bash(firebase:*)",
      "Bash(adb:*)",
      "Bash(open:*)",
      "Bash(kill:*)",
      "Bash(pkill:*)",
      "Bash(ps:*)",
      "Bash(ls:*)",
      "Bash(cd:*)",
      "Bash(pwd)",
      "Bash(mkdir:*)",
      "Bash(rm:*)",
      "Bash(cp:*)",
      "Bash(mv:*)",
      "Bash(cat:*)",
      "Bash(echo:*)",
      "WebFetch(domain:code.claude.com)",
      "Read(~/.zshrc)",
      "Read(~/.bashrc)",
      "Read(~/.gitconfig)",
      "Bash(nc:*)",
      "Bash(tee:*)",
      "Bash(find:*)",
      "Bash(/dev/tcp/127.0.0.1/58259)",
      "Bash(brew upgrade:*)",
      "Bash(wc:*)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking status CLAUDE.md)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking diff --stat CLAUDE.md)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking ls-files:*)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking status --porcelain)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking diff --stat claude.md)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking checkout HEAD -- claude.md)",
      "Bash(lsof:*)",
      "Bash(xargs kill:*)",
      "WebFetch(domain:github.com)",
      "Bash(claude mcp remove:*)",
      "Bash(claude mcp add:*)",
      "Bash(claude mcp list:*)",
      "Bash(sed:*)",
      "Bash(tree:*)",
      "Bash(sort:*)",
      "mcp__context7__resolve-library-id",
      "mcp__firebase__firestore_list_collections",
      "mcp__firebase__firestore_query_collection",
      "mcp__stripe__get_stripe_account_info",
      "mcp__firebase__firestore_get_documents",
      "mcp__stripe__search_stripe_documentation",
      "Bash(stripe events resend:*)",
      "Bash(stripe webhook_endpoints delete:*)",
      "SlashCommand(/misc:feature-plan ultrathink)",
      "SlashCommand(/misc:code-explain)",
      "Bash(python3:*)",
      "mcp__firebase__firebase_get_environment",
      "mcp__context7__get-library-docs",
      "WebFetch(domain:rab-booking-widget.web.app)",
      "SlashCommand(/misc:code-explain ultrathink)",
      "mcp__firebase__firebase_get_project",
      "mcp__firebase__firebase_list_apps",
      "WebFetch(domain:console.firebase.google.com)",
      "Bash(grep:*)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking status --short)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking add lib/features/widget/presentation/widgets/month_calendar_widget.dart lib/features/widget/presentation/widgets/year_calendar_widget.dart lib/features/widget/presentation/widgets/calendar/calendar_combined_header_widget.dart lib/features/widget/presentation/widgets/calendar/year_calendar_painters.dart .claude/plans/calendar-widgets-refactoring.md)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking add lib/features/widget/presentation/widgets/month_calendar_widget.dart lib/features/widget/presentation/widgets/year_calendar_widget.dart lib/features/widget/presentation/widgets/calendar/calendar_combined_header_widget.dart lib/features/widget/presentation/widgets/calendar/year_calendar_painters.dart)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking log -3 --oneline)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking log --oneline --since=\"2025-12-01\")",
      "Bash(git -C /Users/duskolicanin/git/rab_booking diff --stat)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking log --oneline -3)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking add functions/src/guestCancelBooking.ts functions/src/stripePayment.ts functions/src/emailService.ts lib/shared/models/booking_model.dart lib/shared/models/booking_model.freezed.dart lib/shared/models/booking_model.g.dart)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking commit -m \"$(cat <<''EOF''\nfix: critical Cloud Function bugs and BookingModel update\n\n- Fix guestCancelBooking.ts widget settings lookup (wrong collection path)\n  - Was: widget_settings/{unitId} (top-level - WRONG)\n  - Now: properties/{propertyId}/widget_settings/{unitId} (subcollection - CORRECT)\n\n- Add auto-refund for date conflicts in stripePayment.ts\n  - When dates are booked between checkout and webhook\n  - Automatically issues Stripe refund instead of manual intervention\n\n- Fix emailService.ts Firebase initialization order\n  - Import db from ./firebase instead of initializing at module level\n\n- Add depositAmount and remainingAmount fields to BookingModel\n  - Syncs with Firestore fields written by webhook\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git -C /Users/duskolicanin/git/rab_booking add functions/src/stripePayment.ts lib/features/widget/data/repositories/firebase_booking_calendar_repository.dart lib/features/widget/presentation/providers/realtime_booking_calendar_provider.dart lib/features/widget/presentation/providers/realtime_booking_calendar_provider.g.dart lib/features/widget/presentation/widgets/month_calendar_widget.dart lib/features/widget/presentation/widgets/year_calendar_widget.dart test/features/widget/data/repositories/firebase_booking_calendar_repository_test.dart)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking add functions/src/stripePayment.ts lib/features/widget/data/repositories/firebase_booking_calendar_repository.dart lib/features/widget/presentation/providers/realtime_booking_calendar_provider.dart lib/features/widget/presentation/widgets/month_calendar_widget.dart lib/features/widget/presentation/widgets/year_calendar_widget.dart test/features/widget/data/repositories/firebase_booking_calendar_repository_test.dart)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking commit -m \"$(cat <<''EOF''\nfix: deep analysis bug fixes (3 critical issues)\n\nBUG #1 - Invalid ''in_progress'' status in calendar queries:\n- Removed ''in_progress'' from status filter (doesn''t exist in BookingStatus enum)\n- Now correctly queries for [''pending'', ''confirmed''] only\n\nBUG #2 - Wrong Stripe field name in webhook:\n- Changed stripe_payment_intent â†’ payment_intent_id\n- Fixes: Flutter BookingModel couldn''t read payment intent from Firestore\n\nBUG #3 - Widget settings path in calendar repository:\n- Changed from widget_settings/{unitId} (wrong - top-level)\n- To properties/{propertyId}/widget_settings/{unitId} (correct - subcollection)\n- Added propertyId parameter to repository methods and providers\n- Updated calendar widgets to pass propertyId\n- Updated tests with propertyId parameter\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git -C /Users/duskolicanin/git/rab_booking add functions/src/stripePayment.ts functions/src/bookingManagement.ts)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking commit -m \"$(cat <<''EOF''\nfix: deep analysis round 3 - webhook robustness\n\n- Add propertyId to sendBookingApprovedEmail in bookingManagement.ts\n  (enables email subdomain links for approved bookings)\n\n- Add refund failure tracking in stripePayment.ts\n  (creates refund_pending record when auto-refund fails)\n\n- Add numeric validation for webhook metadata\n  (prevents NaN issues from malformed metadata)\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git -C /Users/duskolicanin/git/rab_booking add )",
      "Bash(functions/src/stripePayment.ts )",
      "Bash(functions/src/atomicBooking.ts )",
      "Bash(lib/shared/models/booking_model.dart )",
      "Bash(lib/shared/models/booking_model.freezed.dart )",
      "Bash(lib/shared/models/booking_model.g.dart )",
      "Bash(lib/features/widget/data/repositories/firebase_booking_calendar_repository.dart )",
      "Bash(lib/shared/widgets/widgets.dart)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking commit -m \"$(cat <<''EOF''\nfix: deep analysis round 4 - critical bug fixes\n\nCRITICAL FIXES:\n- Add Stripe webhook idempotency check (prevents duplicate bookings)\n- Add stream error handling to calendar repository (prevents UI crashes)\n\nHIGH PRIORITY FIXES:\n- Add missing BookingModel fields: propertyId, paymentOption, requireOwnerApproval\n- Add guest count validation against unit''s max_guests in atomicBooking\n\nBUG FIX:\n- Remove deleted dialog.dart export from widgets.dart\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(functions/src/emailService.ts )",
      "Bash(functions/src/customEmail.ts )",
      "Bash(functions/src/atomicBooking.ts)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking commit -m \"$(cat <<''EOF''\nfix: deep analysis round 5 - security fixes\n\nCRITICAL SECURITY FIX:\n- Add HTML escaping to prevent XSS in custom guest emails\n  (emailService.ts: escapeHtml for subject, guestName, message)\n\nHIGH PRIORITY:\n- Add input validation to custom email function\n  (customEmail.ts: length limits for email, name, subject, message)\n\nMEDIUM PRIORITY:\n- Improve guest count validation with bounds checking\n  (atomicBooking.ts: validate integer >= 1, not just max)\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(functions/src/bookingAccessToken.ts )",
      "Bash(functions/src/notificationService.ts )",
      "Bash(lib/features/widget/presentation/screens/booking_widget_screen.dart)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking add functions/src/emailService.ts functions/src/icalExport.ts functions/src/icalSync.ts lib/core/services/notification_service.dart)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking diff --stat lib/)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking add:*)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking log --oneline -5)",
      "Bash(done)"
    ],
    "deny": [
      "Read(.env)",
      "Read(.env.*)",
      "Read(**/.env)",
      "Read(**/.env.*)",
      "Read(**/secrets/**)",
      "Read(**/credentials.json)",
      "Read(~/.ssh/**)",
      "Read(~/.aws/**)",
      "Bash(rm -rf /*)",
      "Bash(sudo:*)",
      "Bash(curl:*)",
      "Bash(wget:*)"
    ],
    "ask": []
  }
}
