{
  "permissions": {
    "allow": [
      "SlashCommand(/misc:feature-plan)",
      "Bash(chmod:*)",
      "Bash(gsutil cors set:*)",
      "Bash(gsutil ls:*)",
      "Bash(git -C /Users/duskolicanin/git/rab_booking commit -m \"$(cat <<''EOF''\nsecurity: critical Firebase rules and CORS hardening\n\nCRITICAL SECURITY FIXES (Problems #63 & #64):\n\n1. BOOKINGS COLLECTION - 3 minimal exceptions:\n   - Stripe polling: WHERE stripe_session_id == \"cs_xxx\" LIMIT 1\n   - Guest email links: WHERE booking_reference == \"REF123\" LIMIT 1\n   - Owner authenticated: resource.data.owner_id == request.auth.uid\n   - Blocks: direct access, enumeration, data theft\n\n2. LOGIN ATTEMPTS - Cloud Functions only:\n   - Before: allow read, write: if true (security bypass)\n   - After: allow read, write: if false\n   - Prevents rate limit bypass\n\n3. SECURITY EVENTS - Cloud Functions only:\n   - Before: allow write: if true (log poisoning)\n   - After: allow write: if false\n   - Prevents malicious log entries\n\n4. BOOKING SERVICES - Input validation:\n   - Validates required fields (bookingId, serviceId, price)\n   - Enforces non-negative price\n   - Prevents fake service charges\n\n5. CORS CONFIGURATION - Restricted origins:\n   - Before: \"origin\": [\"*\"] (all domains)\n   - After: Whitelist (rab-booking-widget.web.app + localhost)\n   - Prevents bandwidth theft, data scraping\n\nIMPACT:\nâœ… Fixes GDPR violation (unauthorized booking access)\nâœ… No code changes required (rules-only)\nâœ… Backward compatible (Stripe flow, email links, dashboard work)\nâœ… Zero downtime deployment\n\nFILES:\n- firestore.rules: Security rules with minimal exceptions\n- cors.json: Restricted CORS origins\n- .claude/SECURITY_FIX_SUMMARY.md: Deployment guide\n- .claude/plans/security-audit-plan.md: Full analysis\n- test_firestore_rules.sh: Rules testing script\n- *.backup: Rollback files\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(npm run build:*)",
      "Bash(npx eslint:*)",
      "Bash(cat:*)"
    ],
    "deny": [],
    "ask": []
  }
}
