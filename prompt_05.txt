PROMPT 5: Supabase Database Schema & Migrations

Generiši kompletne SQL skripte za Supabase:

1. CREATE TABLES MIGRATION (`supabase/migrations/001_initial_schema.sql`):

   Kreiraj tabele sa:
   - Proper data types (UUID, TIMESTAMPTZ, JSONB)
   - Primary keys, Foreign keys, Indexes
   - Check constraints (e.g., check_out > check_in)
   - Default values (created_at, updated_at)

   Tabele: users, properties, units, bookings, payments

2. ROW LEVEL SECURITY (`supabase/migrations/002_rls_policies.sql`):

   Za svaku tabelu:
   - ENABLE RLS
   - SELECT policy (who can read)
   - INSERT policy (who can create)
   - UPDATE policy (who can modify)
   - DELETE policy (who can delete)

   Multi-tenancy pravila:
   - Owners see only their data
   - Guests see public data + their bookings
   - Admin role za punu kontrolu

   Implementiraj security policies za:
   - Users: mogu čitati svoj profil, admini sve
   - Properties: vlasnici CRUD svoje, svi čitaju published
   - Units: isto kao properties
   - Bookings: gosti vide svoje, vlasnici vide bookings svojih property
   - Payments: samo owner i guest mogu vidjeti payment za svoj booking

3. REALTIME SETUP (`supabase/migrations/003_realtime.sql`):
   - Enable realtime za bookings tabelu
   - Setup broadcast/presence channels

4. FUNCTIONS & TRIGGERS:
   - auto_update_updated_at() trigger function
   - check_unit_availability() function za booking validation
   - calculate_booking_total() function

5. INDEXES & PERFORMANCE:
   - Index na property.location za search
   - Index na booking (check_in, check_out) za availability queries
   - Composite indexes gdje je potrebno

6. CLI KOMANDE:
   Napiši README.md sa tačnim Supabase CLI komandama za:
   - Init projekta
   - Link sa remote projektom
   - Apply migrations
   - Reset database (dev)

   Dodaj i seed data script za testiranje.

DELIVERABLES:
- Sve SQL migration fajlove spremne za Supabase CLI
- RLS policies konfigurisane
- Realtime setup
- Seed data script
- Database documentation (ERD diagram ili Markdown opis relacija)
- CLI komande dokumentacija
