PROMPT 11: Authentication Flow

Implementiraj kompletan auth flow sa Supabase:

1. AUTH SCREENS:

   a) `lib/features/auth/presentation/screens/login_screen.dart`:
      - Email field sa validacijom
      - Password field sa visibility toggle
      - "Forgot password?" link
      - "Login" button
      - "Or continue with Google" (social auth)
      - "Don't have account? Register" link

   b) `register_screen.dart`:
      - First/Last name fields
      - Email, Password, Confirm Password
      - Role selection (Guest/Owner)
      - Terms & Conditions checkbox
      - "Create Account" button

   c) `forgot_password_screen.dart`:
      - Email input
      - "Send Reset Link" button
      - Back to login link

2. VALIDATION:
   - Email format validation
   - Password strength indicator
   - Real-time error messages

3. AUTH SERVICE:
   - signIn(email, password)
   - signUp(email, password, userData)
   - signOut()
   - resetPassword(email)
   - signInWithGoogle()

4. SUPABASE AUTH INTEGRATION:

   `lib/features/auth/data/auth_repository.dart`:

   Methods:
   - signInWithEmail(email, password)
   - signUpWithEmail(email, password, metadata)
   - signInWithGoogle()
   - signOut()
   - sendPasswordResetEmail(email)
   - getCurrentUser()
   - onAuthStateChange (stream)

5. STATE MANAGEMENT:

   `lib/features/auth/providers/auth_provider.dart`:

   ```dart
   final authProvider = StreamProvider<User?>((ref) {
     return Supabase.instance.client.auth.onAuthStateChange
       .map((data) => data.session?.user);
   });

   final authNotifierProvider = NotifierProvider<AuthNotifier, AsyncValue<void>>(() {
     return AuthNotifier();
   });
   ```

   - AuthNotifier (Riverpod StateNotifier):
     * State: AuthState (authenticated, unauthenticated, loading)
     * currentUser property
     * Listen to Supabase auth stream
     * Auto-update on auth changes

6. NAVIGATION GUARD:
   GoRouter redirect logic za protected routes.

7. FORM VALIDATION:

   - Email: Regex validation
   - Password: Min 8 chars, uppercase, number
   - Confirm password: Match check
   - Real-time error messages

Implementiraj sa error handling i loading states.

8. ERROR HANDLING:

   - Network errors
   - Invalid credentials
   - Email already exists
   - Weak password
   - User-friendly error messages sa SnackBar

9. POST-AUTH FLOW:

   - After successful login/register:
     * Fetch user profile from Supabase
     * Store in AuthNotifier
     * Redirect based on role:
       - Guest → Home screen
       - Owner → Owner Dashboard
   - Persist session (Supabase handles this)

10. SOCIAL AUTH (Google):

   - Setup Google Sign-In package
   - Supabase OAuth configuration
   - Handle OAuth callback
   - Create/update user profile

DELIVERABLES:
- Login, Register, Forgot Password screens
- Supabase Auth Repository
- AuthNotifier (Riverpod) sa stream listener
- Form validation logic
- Error handling sa user-friendly messages
- Google OAuth integration
- Role-based post-auth redirect
- Session persistence
